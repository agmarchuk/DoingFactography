# Как делать кассеты

Кассета - специальный репозиторий, предназанченный для структурированного хранения мультимедиа файлов и обеспечения к ним доступа. И хотя файлы могут быть не только мультимедиа, а просто файлами, ориентация на мультимедиа проявляется в том, что для фото, видео и аудио файлов создаются условия, когда этот контент может доставляться потребителям в реальном времени и с меньшеми затратами на перемещение. Это делается с помощью специально подготовленных копий разного размера. Например, tiff фотография может "весить" 50 Мб, а ее копия, предназанченная для оперативного просмотра - 200 Кб. Совсем маленькие копии таких фотографий могут иметь объем в единицы килобайт. Это позволяет в реальном времени формировать в браузере композиции, состоящие из единичных фотографий достаточно большого размера и множества маленьких. 

Кассета характерна еще тем, что имеется также иерархическая структура размещения файлов в виде директорий, поддиректорий и файлов. Эта структура формируется в виде метаинформации - базы данных, выполненной в виде RDF-файла формата XML.

Кассета реализуется в виде иерархии директорий и файлов. У кассеты есть имя, оно совпадает с именем корневой директории. Имя кассеты довольно трудно изменить, это реально слабое место построения. Структура директории:
```
[имякассеты]
  cassette.finfo
  [originals]
    [0001]
      0001.ext
      0002.ext
      ...
    [0002]
      0001.ext
      0002.ext
      ...
  [documents]
    [small]
      [0001]
        0001.pre
        ...    
    [medium]
      [0001]     
    [normal]
      [0001]     
  [meta]
    имякассеты_current.fog
```
Квадратные скобки с текстом обозначают директорию и ее имя, без квадратных скобок - файлы. Таким образом, в кассете есть: оригиналы хранимых мультимедиа документов, их превью-копии размеров small, medium, normal и файл с метаинформацией в разделе meta. В корне есть файл, специфицирующий диреторию как касету.

Расширение .ext - расширение файла (.jpg, .mp4 и др.), расширение .pre - это расширение превью-файла (превьюшки), для действующей реализации для фото используется .jpg, для видео .mp4. Допустимо иметь несколько превьюшек этого размера для одного файла, напр. по некоторым причинам, для видео, воспроизводимого через Веб, нужно несколько форматов, напр. .mp4 и .webm. Главное условие, чтобы для одного файла в originals/DDDD все превьюшки должны   быть в соответствующих разделах documents/SIZE/DDDD с тем же DDDD. И должны иметь тот же номер-имя файла. Только расширитель может быть другой. 

Служебные имена файлов являются цифровыми, выровненными до 4 символов. Принципиальной логики в последовательности номеров не установлено. Также нет обязательности в использовании номеров в разных секциях DDDD. Сейчас это - повторение номеров с 0001 для каждой секции и последовательная нумерация, начиная с 1. Кажется, псевдоцифоровые имена файлов могут быть заменены на произвольные и если сделать небольшие изменения в коде, и 4 символа также не являются догмой. 

Фактически, сохранение документного файла в кассете означает следующее: файл получает новое имя в виде кода и помещается в очередную секцию. Количество файлов в секции не регламентировано и пока подразумевается в 1000. По идее, надо выяснить влияние количества файлов в директории на скорость доступа к файлам по имени и найти разумное количество. 


